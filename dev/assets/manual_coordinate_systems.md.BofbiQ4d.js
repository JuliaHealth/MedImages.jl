import{_ as s,c as a,o as n,aA as t}from"./chunks/framework.DwLlzrnL.js";const o=JSON.parse('{"title":"Coordinate Systems Guide","description":"","frontmatter":{},"headers":[],"relativePath":"manual/coordinate_systems.md","filePath":"manual/coordinate_systems.md","lastUpdated":null}'),e={name:"manual/coordinate_systems.md"};function l(h,i,p,k,r,d){return n(),a("div",null,[...i[0]||(i[0]=[t(`<h1 id="Coordinate-Systems-Guide" tabindex="-1">Coordinate Systems Guide <a class="header-anchor" href="#Coordinate-Systems-Guide" aria-label="Permalink to &quot;Coordinate Systems Guide {#Coordinate-Systems-Guide}&quot;">​</a></h1><p>This guide explains the coordinate system conventions used in MedImages.jl and how they relate to medical imaging standards.</p><h2 id="Overview" tabindex="-1">Overview <a class="header-anchor" href="#Overview" aria-label="Permalink to &quot;Overview {#Overview}&quot;">​</a></h2><p>Medical imaging involves multiple coordinate systems:</p><ol><li><p><strong>Array Index Space</strong>: How voxels are stored in memory</p></li><li><p><strong>Physical Space</strong>: Real-world coordinates in millimeters</p></li><li><p><strong>Patient Space</strong>: Anatomical directions (Left/Right, Anterior/Posterior, Superior/Inferior)</p></li></ol><p>Understanding these relationships is crucial for correct spatial operations.</p><hr><h2 id="Array-Index-Space" tabindex="-1">Array Index Space <a class="header-anchor" href="#Array-Index-Space" aria-label="Permalink to &quot;Array Index Space {#Array-Index-Space}&quot;">​</a></h2><h3 id="Julia-Array-Conventions" tabindex="-1">Julia Array Conventions <a class="header-anchor" href="#Julia-Array-Conventions" aria-label="Permalink to &quot;Julia Array Conventions {#Julia-Array-Conventions}&quot;">​</a></h3><p>Julia uses column-major ordering, which affects how 3D medical images are stored:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>image.voxel_data[dim1, dim2, dim3]</span></span>
<span class="line"><span>                  |      |      |</span></span>
<span class="line"><span>                  Z      Y      X  (physical mapping)</span></span></code></pre></div><p><strong>Key Points:</strong></p><ul><li><p>First dimension (dim1) corresponds to Z (axial slices)</p></li><li><p>Second dimension (dim2) corresponds to Y (coronal direction)</p></li><li><p>Third dimension (dim3) corresponds to X (sagittal direction)</p></li><li><p>Indices are 1-based in Julia</p></li></ul><p><strong>Example:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Access voxel at physical position (x=50, y=100, z=25)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In Julia array indexing:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [z, y, x]</span></span></code></pre></div><hr><h2 id="Physical-Space" tabindex="-1">Physical Space <a class="header-anchor" href="#Physical-Space" aria-label="Permalink to &quot;Physical Space {#Physical-Space}&quot;">​</a></h2><h3 id="Origin-and-Spacing" tabindex="-1">Origin and Spacing <a class="header-anchor" href="#Origin-and-Spacing" aria-label="Permalink to &quot;Origin and Spacing {#Origin-and-Spacing}&quot;">​</a></h3><p>Physical coordinates are defined by the <code>origin</code> and <code>spacing</code> fields:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Origin: Physical coordinates of voxel [1,1,1] in mm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (x0, y0, z0)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Spacing: Distance between voxels in mm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dx, dy, dz)</span></span></code></pre></div><p><strong>Note:</strong> Origin and spacing use (x, y, z) ordering, consistent with ITK and SimpleITK.</p><h3 id="Index-to-Physical-Point-Transformation" tabindex="-1">Index to Physical Point Transformation <a class="header-anchor" href="#Index-to-Physical-Point-Transformation" aria-label="Permalink to &quot;Index to Physical Point Transformation {#Index-to-Physical-Point-Transformation}&quot;">​</a></h3><p>The transformation from array index to physical coordinates:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Physical_X = Origin_X + (index_X - 1) * Spacing_X * Direction[1:3]</span></span>
<span class="line"><span>Physical_Y = Origin_Y + (index_Y - 1) * Spacing_Y * Direction[4:6]</span></span>
<span class="line"><span>Physical_Z = Origin_Z + (index_Z - 1) * Spacing_Z * Direction[7:9]</span></span></code></pre></div><p><strong>Using MedImages.jl:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Transform voxel index to physical point</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">physical_point </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> transformIndexToPhysicalPoint_Julia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, (i, j, k))</span></span></code></pre></div><hr><h2 id="Direction-Cosine-Matrix" tabindex="-1">Direction Cosine Matrix <a class="header-anchor" href="#Direction-Cosine-Matrix" aria-label="Permalink to &quot;Direction Cosine Matrix {#Direction-Cosine-Matrix}&quot;">​</a></h2><p>The <code>direction</code> field is a 9-element tuple representing a 3x3 rotation matrix:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>direction = (d1, d2, d3, d4, d5, d6, d7, d8, d9)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Matrix form:</span></span>
<span class="line"><span>| d1 d2 d3 |   Defines how image axes</span></span>
<span class="line"><span>| d4 d5 d6 |   align with physical axes</span></span>
<span class="line"><span>| d7 d8 d9 |</span></span></code></pre></div><h3 id="Common-Direction-Matrices" tabindex="-1">Common Direction Matrices <a class="header-anchor" href="#Common-Direction-Matrices" aria-label="Permalink to &quot;Common Direction Matrices {#Common-Direction-Matrices}&quot;">​</a></h3><p><strong>Identity (LPS orientation):</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">direction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><p>Image X-axis aligned with physical X (Left)</p></li><li><p>Image Y-axis aligned with physical Y (Posterior)</p></li><li><p>Image Z-axis aligned with physical Z (Superior)</p></li></ul><p><strong>RAS orientation:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">direction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><p>Image X-axis points Right (opposite of physical X)</p></li><li><p>Image Y-axis points Anterior (opposite of physical Y)</p></li><li><p>Image Z-axis points Superior (same as physical Z)</p></li></ul><hr><h2 id="Patient-Coordinate-System" tabindex="-1">Patient Coordinate System <a class="header-anchor" href="#Patient-Coordinate-System" aria-label="Permalink to &quot;Patient Coordinate System {#Patient-Coordinate-System}&quot;">​</a></h2><h3 id="Anatomical-Directions" tabindex="-1">Anatomical Directions <a class="header-anchor" href="#Anatomical-Directions" aria-label="Permalink to &quot;Anatomical Directions {#Anatomical-Directions}&quot;">​</a></h3><p>Medical imaging uses patient-relative directions:</p><table tabindex="0"><thead><tr><th style="text-align:right;">Direction</th><th style="text-align:right;">Abbreviation</th><th style="text-align:right;">Description</th></tr></thead><tbody><tr><td style="text-align:right;">Left</td><td style="text-align:right;">L</td><td style="text-align:right;">Patient&#39;s left side</td></tr><tr><td style="text-align:right;">Right</td><td style="text-align:right;">R</td><td style="text-align:right;">Patient&#39;s right side</td></tr><tr><td style="text-align:right;">Anterior</td><td style="text-align:right;">A</td><td style="text-align:right;">Front of patient</td></tr><tr><td style="text-align:right;">Posterior</td><td style="text-align:right;">P</td><td style="text-align:right;">Back of patient</td></tr><tr><td style="text-align:right;">Superior</td><td style="text-align:right;">S</td><td style="text-align:right;">Towards head</td></tr><tr><td style="text-align:right;">Inferior</td><td style="text-align:right;">I</td><td style="text-align:right;">Towards feet</td></tr></tbody></table><h3 id="Orientation-Codes" tabindex="-1">Orientation Codes <a class="header-anchor" href="#Orientation-Codes" aria-label="Permalink to &quot;Orientation Codes {#Orientation-Codes}&quot;">​</a></h3><p>MedImages.jl uses 3-letter orientation codes:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Orientation_code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_RPI  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Right,    Y+ = Posterior, Z+ = Inferior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_LPI  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Left,     Y+ = Posterior, Z+ = Inferior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_RAI  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Right,    Y+ = Anterior,  Z+ = Inferior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_LAI  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Left,     Y+ = Anterior,  Z+ = Inferior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_RPS  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Right,    Y+ = Posterior, Z+ = Superior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_LPS  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Left,     Y+ = Posterior, Z+ = Superior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_RAS  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Right,    Y+ = Anterior,  Z+ = Superior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ORIENTATION_LAS  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># X+ = Left,     Y+ = Anterior,  Z+ = Superior</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p><strong>Reading Orientation Codes:</strong></p><ul><li><p>First letter: Direction of increasing X</p></li><li><p>Second letter: Direction of increasing Y</p></li><li><p>Third letter: Direction of increasing Z</p></li></ul><hr><h2 id="Common-Conventions" tabindex="-1">Common Conventions <a class="header-anchor" href="#Common-Conventions" aria-label="Permalink to &quot;Common Conventions {#Common-Conventions}&quot;">​</a></h2><h3 id="DICOM-/-ITK-/-SimpleITK-LPS" tabindex="-1">DICOM / ITK / SimpleITK (LPS) <a class="header-anchor" href="#DICOM-/-ITK-/-SimpleITK-LPS" aria-label="Permalink to &quot;DICOM / ITK / SimpleITK (LPS) {#DICOM-/-ITK-/-SimpleITK-LPS}&quot;">​</a></h3><p>The default standard for most medical imaging:</p><ul><li><p><strong>X+</strong> points to patient&#39;s Left</p></li><li><p><strong>Y+</strong> points to Posterior</p></li><li><p><strong>Z+</strong> points to Superior</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MedImages.jl default (via ITKIOWrapper)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> load_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;scan.nii.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Loaded in LPS</span></span></code></pre></div><h3 id="Neuroimaging-RAS" tabindex="-1">Neuroimaging (RAS) <a class="header-anchor" href="#Neuroimaging-RAS" aria-label="Permalink to &quot;Neuroimaging (RAS) {#Neuroimaging-RAS}&quot;">​</a></h3><p>Common in brain imaging software (FreeSurfer, FSL, MNI):</p><ul><li><p><strong>X+</strong> points to patient&#39;s Right</p></li><li><p><strong>Y+</strong> points to Anterior</p></li><li><p><strong>Z+</strong> points to Superior</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Convert to RAS for neuroimaging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ras_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, ORIENTATION_RAS)</span></span></code></pre></div><hr><h2 id="Coordinate-Transformations" tabindex="-1">Coordinate Transformations <a class="header-anchor" href="#Coordinate-Transformations" aria-label="Permalink to &quot;Coordinate Transformations {#Coordinate-Transformations}&quot;">​</a></h2><h3 id="Changing-Orientation" tabindex="-1">Changing Orientation <a class="header-anchor" href="#Changing-Orientation" aria-label="Permalink to &quot;Changing Orientation {#Changing-Orientation}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MedImages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Load image (default LPS)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> load_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;scan.nii.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check current orientation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">current_orient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> number_to_enum_orientation_dict[image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">direction]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, orientation_enum_to_string[current_orient])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Change to RAS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ras_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, ORIENTATION_RAS)</span></span></code></pre></div><p><strong>What happens during orientation change:</strong></p><ol><li><p>Voxel array is permuted to reorder dimensions</p></li><li><p>Axes may be reversed (flipped)</p></li><li><p>Origin is recalculated</p></li><li><p>Spacing is reordered</p></li><li><p>Direction matrix is updated</p></li></ol><h3 id="Manual-Coordinate-Conversion" tabindex="-1">Manual Coordinate Conversion <a class="header-anchor" href="#Manual-Coordinate-Conversion" aria-label="Permalink to &quot;Manual Coordinate Conversion {#Manual-Coordinate-Conversion}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Voxel index to physical coordinates</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> voxel_to_physical</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, voxel_idx)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # voxel_idx is (z, y, x) in Julia order</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (voxel_idx[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (voxel_idx[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (voxel_idx[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (x, y, z)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Physical coordinates to voxel index</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> physical_to_voxel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, physical_pt)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, (physical_pt[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, (physical_pt[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    z_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, (physical_pt[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (z_idx, y_idx, x_idx)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Julia array order</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><hr><h2 id="Practical-Examples" tabindex="-1">Practical Examples <a class="header-anchor" href="#Practical-Examples" aria-label="Permalink to &quot;Practical Examples {#Practical-Examples}&quot;">​</a></h2><h3 id="Example-1:-Finding-Image-Center" tabindex="-1">Example 1: Finding Image Center <a class="header-anchor" href="#Example-1:-Finding-Image-Center" aria-label="Permalink to &quot;Example 1: Finding Image Center {#Example-1:-Finding-Image-Center}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Voxel center</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_center </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_voxel_center_Julia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_data)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Physical center</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">physical_center </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_real_center_Julia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Voxel center: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, voxel_center)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Physical center (mm): &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, physical_center)</span></span></code></pre></div><h3 id="Example-2:-Checking-Physical-Extent" tabindex="-1">Example 2: Checking Physical Extent <a class="header-anchor" href="#Example-2:-Checking-Physical-Extent" aria-label="Permalink to &quot;Example 2: Checking Physical Extent {#Example-2:-Checking-Physical-Extent}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Calculate physical extent of image</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Physical extent in each direction</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extent_x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dims[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dim3 = X</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extent_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dims[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dim2 = Y</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extent_z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dims[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> spacing[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dim1 = Z</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Physical extent (mm):&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;  X: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[1])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[1] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extent_x)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;  Y: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[2])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[2] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extent_y)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;  Z: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[3])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(origin[3] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extent_z)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="Example-3:-Resampling-with-Coordinate-Preservation" tabindex="-1">Example 3: Resampling with Coordinate Preservation <a class="header-anchor" href="#Example-3:-Resampling-with-Coordinate-Preservation" aria-label="Permalink to &quot;Example 3: Resampling with Coordinate Preservation {#Example-3:-Resampling-with-Coordinate-Preservation}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Original physical extent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">original_extent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Resample to isotropic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resampled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resample_to_spacing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Linear_en)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># New extent (should be similar)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_extent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resampled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voxel_data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resampled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spacing)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Original extent: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, original_extent)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Resampled extent: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, new_extent)</span></span></code></pre></div><hr><h2 id="Troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#Troubleshooting" aria-label="Permalink to &quot;Troubleshooting {#Troubleshooting}&quot;">​</a></h2><h3 id="Issue:-Image-Appears-Flipped" tabindex="-1">Issue: Image Appears Flipped <a class="header-anchor" href="#Issue:-Image-Appears-Flipped" aria-label="Permalink to &quot;Issue: Image Appears Flipped {#Issue:-Image-Appears-Flipped}&quot;">​</a></h3><p><strong>Cause:</strong> Incorrect orientation handling between software packages.</p><p><strong>Solution:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check and correct orientation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> number_to_enum_orientation_dict[image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">direction]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current orientation: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, current)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Convert to expected orientation</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ORIENTATION_LPS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, ORIENTATION_LPS)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="Issue:-Registration-Misalignment" tabindex="-1">Issue: Registration Misalignment <a class="header-anchor" href="#Issue:-Registration-Misalignment" aria-label="Permalink to &quot;Issue: Registration Misalignment {#Issue:-Registration-Misalignment}&quot;">​</a></h3><p><strong>Cause:</strong> Images have different orientations.</p><p><strong>Solution:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ensure both images have same orientation before registration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fixed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fixed, ORIENTATION_LPS)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">moving </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(moving, ORIENTATION_LPS)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Then resample</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">registered </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resample_to_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fixed, moving, Linear_en)</span></span></code></pre></div><h3 id="Issue:-Coordinates-Don&#39;t-Match-External-Software" tabindex="-1">Issue: Coordinates Don&#39;t Match External Software <a class="header-anchor" href="#Issue:-Coordinates-Don&#39;t-Match-External-Software" aria-label="Permalink to &quot;Issue: Coordinates Don&amp;#39;t Match External Software {#Issue:-Coordinates-Don&#39;t-Match-External-Software}&quot;">​</a></h3><p><strong>Cause:</strong> Different coordinate system conventions.</p><p><strong>Solution:</strong> Check the orientation expected by the external software and convert:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For neuroimaging software expecting RAS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ras_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> change_orientation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, ORIENTATION_RAS)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_nii_from_medimage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ras_image, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;output_for_fsl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><hr><h2 id="Summary-Table" tabindex="-1">Summary Table <a class="header-anchor" href="#Summary-Table" aria-label="Permalink to &quot;Summary Table {#Summary-Table}&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:right;">Aspect</th><th style="text-align:right;">Julia Arrays</th><th style="text-align:right;">Physical Space</th><th style="text-align:right;">Notes</th></tr></thead><tbody><tr><td style="text-align:right;">Dimension Order</td><td style="text-align:right;">(dim1, dim2, dim3)</td><td style="text-align:right;">(X, Y, Z)</td><td style="text-align:right;">dim1=Z, dim2=Y, dim3=X</td></tr><tr><td style="text-align:right;">Index Base</td><td style="text-align:right;">1-based</td><td style="text-align:right;">N/A</td><td style="text-align:right;">SimpleITK uses 0-based</td></tr><tr><td style="text-align:right;">Origin/Spacing</td><td style="text-align:right;">N/A</td><td style="text-align:right;">(x, y, z) tuple</td><td style="text-align:right;">In millimeters</td></tr><tr><td style="text-align:right;">Direction</td><td style="text-align:right;">N/A</td><td style="text-align:right;">9-element tuple</td><td style="text-align:right;">Row-major 3x3 matrix</td></tr><tr><td style="text-align:right;">Default Orientation</td><td style="text-align:right;">N/A</td><td style="text-align:right;">LPS</td><td style="text-align:right;">Via ITKIOWrapper</td></tr></tbody></table>`,90)])])}const E=s(e,[["render",l]]);export{o as __pageData,E as default};
